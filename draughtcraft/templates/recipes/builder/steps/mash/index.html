<%
  def sort(additions):
    return sorted(
      additions,
      lambda a,b: cmp(b.percentage, a.percentage)
    )
%>

<div class="step active clearfix"> 

  <%include file="../../tabs.html" args="active='mash'" />
  
  ${h.form('async/ingredients?_method=put')}
    <div class="ingredient-list">

      <% i = 0 %>

      <h3 class="ribbon">
        <span class="step-help">Mash </span>Ingredients
      </h3>

      % if not editable:
        <p class="instruction">
          If necessary, crush grains.

          Dough in the following fermentable ingredients:
        </p>
      % endif

      % if recipe.mash:
        <table>

          <!-- Malt Additions -->
          % if recipe.mash.get(h.model.Fermentable):
            <tr>
              <th class="type" />
              <th class="percent">%</th>
              <th class="amount">Amount</th>
              <th>Fermentable</th>
              <th>PPG</th>
              <th class="unit">L</th>
              <th class="close" />
            </tr>

            % for addition in sort(recipe.mash.get(h.model.Fermentable)):
              <%include file="../additions/fermentable.html" args="i=i, addition=addition" />
              <% i += 1 %>
            % endfor
          %endif

          <!-- Hop Additions -->
          % if recipe.mash.get(h.model.Hop):
            <tr>
              <th class="type" />
              <th class="percent"></th>
              <th class="amount">Amount</th>
              <th>Variety</th>
              <th>Form</th>
              <th class="unit">AA</th>
              <th class="close" />
            </tr>

            % for addition in sort(recipe.mash.get(h.model.Hop)):
              <%include file="../additions/hop.html" args="i=i, addition=addition" />
              <% i += 1 %>
            % endfor
          %endif

          <!-- Extra Additions -->
          % if recipe.mash.get(h.model.Extra):
            <tr>
              <th class="type" />
              <th class="percent"></th>
              <th class="amount">Amount</th>
              <th>Name</th>
              <th></th>
              <th class="unit"></th>
              <th class="close" />
            </tr>

            % for addition in sort(recipe.mash.get(h.model.Extra)):
              <%include file="../additions/extra.html" args="i=i, addition=addition" />
              <% i += 1 %>
            % endfor
          %endif

        </table>
      % else:
        <table>
          <tr>
            <td>
              Choose one or more fermentables for this recipe.
            </td>
          </tr>
        </table>
      % endif
    </div>
  ${h.end_form()}

  <div class="inventory">
    <%include file="add.html" />
  </div>

</div>
